<h1>All Listings</h1>

<table>
  <tr>
    <th>Listed</th>
    <th>Card</th>
    <th>Edition</th>
    <th>Type</th>
    <th>Condition</th>
    <th>Average Grade</th>
    <th>Graders</th>
    <th>Price</th>
    <th>Listed By</th>
  </tr>

  <% @listings.each do |listing| %>
    <tr>
      <td><%= listing.created_at.strftime("%Y %B %d - %I:%M %p") %></td>
      <td><%= listing.card %></td>
      <td><%= listing.edition %></td>
      <td><%= listing.card_type %></td>
      <td><%= listing.condition %></td>
      <td>
        <% if listing.poll.sum('response') == 0 %>
          0
        <% else %>
          <%= (listing.poll.average('response')).round %>
        <% end %>
      </td>
      <td><%= listing.poll.length %></td>
      <td><%= listing.price %></td>
      <td><%= listing.user.username %></td>
      <td><%= link_to 'View Listing', listing %></td>
      <td>
        <% if current_user.admin %>
          <%= link_to '(Edit Listing)', edit_listing_path(listing) %>
        <% end %>
      </td>
      <td>
        <% if current_user.admin %>
          <%= link_to 'Delete', listing_path(listing),
            method: :delete, data: { confirm: 'Are you sure?' } %>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
